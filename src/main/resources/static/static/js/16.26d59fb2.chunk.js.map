{"version":3,"sources":["config/appConfig.js","config/profile.js","components/wrappers/AuthenticationProvider/AuthenticationProvider.js","components/wrappers/AuthenticationProvider/AuthenticationProviderContainer.js","components/wrappers/AuthenticationProvider/index.js"],"names":["activeProfile","PROD","DEV","AuthenticationProvider","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","onRequestIntercepted","bind","assertThisInitialized","onRequestErrorIntercepted","onResponseIntercepted","onResponseErrorIntercepted","state","tokenRefreshed","_this2","apiController","registerInterceptor","keycloakPath","concat","keycloak","Keycloak","init","onLoad","success","res","setKeycloak","error","console","log","url","config","authenticated","headers","header","AUTHORIZATION","token","method","httpMethod","POST","PUT","XSRF_TOKEN","cookies","get","credentials","response","_this3","status","httpStatus","UNAUTHORIZED","onTokenRefreshError","setState","updateToken","tokenMinValidity","onTokenRefresh","request","unregisterRequest","deleteKeycloak","react_default","a","createElement","children","Component","defaultProps","withCookies","connect","dispatch","AuthorizationProvider","AuthorizationProviderContainer"],"mappings":"mOAEaA,ECFG,CACdC,KAAM,OACNC,IAAK,ODA8BD,KEkB/BE,cAEJ,SAAAA,EAAYC,GAAO,IAAAC,EAAA,OAAAC,OAAAC,EAAA,EAAAD,CAAAE,KAAAL,IACjBE,EAAAC,OAAAG,EAAA,EAAAH,CAAAE,KAAAF,OAAAI,EAAA,EAAAJ,CAAAH,GAAAQ,KAAAH,KAAMJ,KAEDQ,qBAAuBP,EAAKO,qBAAqBC,KAA1BP,OAAAQ,EAAA,EAAAR,QAAAQ,EAAA,EAAAR,CAAAD,KAC5BA,EAAKU,0BAA4BV,EAAKU,0BAA0BF,KAA/BP,OAAAQ,EAAA,EAAAR,QAAAQ,EAAA,EAAAR,CAAAD,KACjCA,EAAKW,sBAAwBX,EAAKW,sBAAsBH,KAA3BP,OAAAQ,EAAA,EAAAR,QAAAQ,EAAA,EAAAR,CAAAD,KAC7BA,EAAKY,2BAA6BZ,EAAKY,2BAA2BJ,KAAhCP,OAAAQ,EAAA,EAAAR,QAAAQ,EAAA,EAAAR,CAAAD,KAElCA,EAAKa,MAAQ,CACXC,gBAAgB,GATDd,mFAaC,IAAAe,EAAAZ,KAClBa,IAAcC,oBACZd,KAAKI,qBACLJ,KAAKO,0BACLP,KAAKQ,sBACLR,KAAKS,4BAEP,IAAMM,EAAY,aAAAC,OAAgBxB,EAAhB,SACZyB,EAAWC,IAASH,GAC1BE,EAASE,KAAK,CAAEC,OAAQ,mBACrBC,QAAQ,SAACC,GACRV,EAAKhB,MAAM2B,YAAYN,KACtBO,MAAM,WAERC,QAAQC,IAAI,wEAIIC,EAAKC,GASxB,OARI5B,KAAKJ,MAAMiC,gBACbD,EAAOE,QAAQC,IAAOC,eAAtB,UAAAhB,OAAiDhB,KAAKJ,MAAMqB,SAASgB,QAGnEL,EAAOM,SAAWC,IAAWC,MAAQR,EAAOM,SAAWC,IAAWE,MACpET,EAAOE,QAAQC,IAAOO,YAActC,KAAKJ,MAAM2C,QAAQC,IAAI,cAC3DZ,EAAOa,YAAc,WAEhB,CAACd,EAAKC,qDAGWJ,GACxB,OAAOA,gDAGakB,GAAU,IAAAC,EAAA3C,KAW9B,OAVI0C,EAASE,SAAWC,IAAWC,cAAiB9C,KAAKU,MAAMC,eAKpD+B,EAASE,SAAWC,IAAWC,cAAgB9C,KAAKU,MAAMC,eACnEX,KAAK+C,sBACI/C,KAAKU,MAAMC,gBACpBX,KAAKgD,SAAS,CAAErC,gBAAgB,IAPhCX,KAAKJ,MAAMqB,SACRgC,YAAYC,KACZ7B,QAAQ,SAACC,GAAD,OAASqB,EAAKQ,mBACtB3B,MAAM,SAACA,GAAD,OAAWmB,EAAKI,wBAMpBL,qDAGkBlB,GACzB,OAAOA,2CAIPxB,KAAKgD,SAAS,CAAErC,gBAAgB,IAChCE,IAAcuC,wDAIdvC,IAAcwC,oBACdrD,KAAKgD,SAAS,CAAErC,gBAAgB,IAChCX,KAAKJ,MAAM0D,kDAIX,OACEC,EAAAC,EAAAC,cAAA,WACGzD,KAAKJ,MAAM8D,iBAjFiBC,aAwFrChE,EAAuBiE,aA1FF,GA4FNC,kBAAYlE,GChGZmE,cAVS,SAACpD,GAAD,MAAY,CAClCO,SAAUP,EAAMO,SAChBY,cAAkC,OAAnBnB,EAAMO,WAGI,SAAC8C,GAAD,MAAe,CACxCxC,YAAa,SAACN,GAAD,OAAc8C,EAASxC,YAAYN,KAChDqC,eAAgB,kBAAMS,EAAST,kBAGlBQ,CAGbE,GCfaC","file":"static/js/16.26d59fb2.chunk.js","sourcesContent":["import profile from \"./profile\";\n\nexport const activeProfile = profile.PROD;\n","const profile = {\n  PROD: \"prod\",\n  DEV: \"dev\",\n};\n\nexport default profile;\n","import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Keycloak from 'keycloak-js';\nimport apiController from '../../../network';\nimport { header, httpMethod, httpStatus, tokenMinValidity } from '../../../network/ApiConst';\nimport { withCookies } from 'react-cookie';\nimport {activeProfile} from \"../../../config/appConfig\";\n\nconst propTypes = {\n  children: PropTypes.any.isRequired,\n\n  setKeycloak: PropTypes.func.isRequired,\n  deleteKeycloak: PropTypes.func.isRequired,\n\n  keycloak: PropTypes.object,\n  authenticated: PropTypes.bool.isRequired,\n};\n\nconst defaultProps = {};\n\nclass AuthenticationProvider extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.onRequestIntercepted = this.onRequestIntercepted.bind(this);\n    this.onRequestErrorIntercepted = this.onRequestErrorIntercepted.bind(this);\n    this.onResponseIntercepted = this.onResponseIntercepted.bind(this);\n    this.onResponseErrorIntercepted = this.onResponseErrorIntercepted.bind(this);\n\n    this.state = {\n      tokenRefreshed: false,\n    };\n  }\n\n  componentDidMount() {\n    apiController.registerInterceptor(\n      this.onRequestIntercepted,\n      this.onRequestErrorIntercepted,\n      this.onResponseIntercepted,\n      this.onResponseErrorIntercepted,\n    );\n    const keycloakPath = `/keycloak-${activeProfile}.json`;\n    const keycloak = Keycloak(keycloakPath);\n    keycloak.init({ onLoad: 'login-required' })\n      .success((res) => {\n        this.props.setKeycloak(keycloak);\n      }).error(() => {\n        // TODO: Handle error properly\n       console.log('Authentication: error');\n      });\n  }\n\n  onRequestIntercepted(url, config) {\n    if (this.props.authenticated) {\n      config.headers[header.AUTHORIZATION] = `Bearer ${this.props.keycloak.token}`;\n    }\n\n    if (config.method === httpMethod.POST || config.method === httpMethod.PUT) {\n      config.headers[header.XSRF_TOKEN] = this.props.cookies.get('XSRF-TOKEN');\n      config.credentials = 'include';\n    }\n    return [url, config];\n  }\n\n  onRequestErrorIntercepted(error) {\n    return error;\n  }\n\n  onResponseIntercepted(response) {\n    if (response.status === httpStatus.UNAUTHORIZED && !this.state.tokenRefreshed) {\n      this.props.keycloak\n        .updateToken(tokenMinValidity)\n        .success((res) => this.onTokenRefresh())\n        .error((error) => this.onTokenRefreshError());\n    } else if (response.status === httpStatus.UNAUTHORIZED && this.state.tokenRefreshed) {\n      this.onTokenRefreshError();\n    } else if (this.state.tokenRefreshed) {\n      this.setState({ tokenRefreshed: false });\n    }\n    return response;\n  }\n\n  onResponseErrorIntercepted(error) {\n    return error;\n  }\n\n  onTokenRefresh() {\n    this.setState({ tokenRefreshed: true });\n    apiController.request();\n  }\n\n  onTokenRefreshError() {\n    apiController.unregisterRequest();\n    this.setState({ tokenRefreshed: false });\n    this.props.deleteKeycloak();\n  }\n\n  render() {\n    return (\n      <div>\n        {this.props.children}\n      </div>\n    );\n  }\n}\n\nAuthenticationProvider.propTypes = propTypes;\nAuthenticationProvider.defaultProps = defaultProps;\n\nexport default withCookies(AuthenticationProvider);\n","import { connect } from 'react-redux';\nimport { deleteKeycloak, setKeycloak } from '../../../actions';\nimport AuthorizationProvider from './AuthenticationProvider';\n\nconst mapStateToProps = (state) => ({\n  keycloak: state.keycloak,\n  authenticated: state.keycloak !== null,\n});\n\nconst mapDispatchToProps = (dispatch) => ({\n  setKeycloak: (keycloak) => dispatch(setKeycloak(keycloak)),\n  deleteKeycloak: () => dispatch(deleteKeycloak()),\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(AuthorizationProvider);\n","import AuthorizationProviderContainer from './AuthenticationProviderContainer';\n\nexport default AuthorizationProviderContainer;\n"],"sourceRoot":""}